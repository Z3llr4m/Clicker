<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Cookie Clicker Deluxe</title>
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      -webkit-tap-highlight-color: transparent;
      -webkit-touch-callout: none;
      -webkit-user-select: none;
      user-select: none;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
      background: linear-gradient(135deg, #1e1e1e 0%, #2d2d2d 100%);
      color: #fff;
      display: flex;
      flex-direction: column;
      height: 100vh;
      overflow: hidden;
      touch-action: manipulation;
    }

    /* Header */
    header {
      padding: 12px;
      background: #2b2b2b;
      text-align: center;
      font-size: 18px;
      font-weight: bold;
      box-shadow: 0 2px 10px rgba(0,0,0,0.3);
      flex-shrink: 0;
    }

    /* Stats */
    #stats-container {
      display: flex;
      justify-content: space-around;
      padding: 10px;
      background: #333;
      border-bottom: 1px solid #444;
      flex-shrink: 0;
    }

    .stat {
      text-align: center;
      padding: 4px;
      font-size: 12px;
    }

    .stat-value {
      font-weight: bold;
      color: #ffcc66;
      font-size: 14px;
    }

    /* Main content with scrolling */
    #main-content {
      flex: 1;
      display: flex;
      flex-direction: column;
      overflow-y: auto;
      -webkit-overflow-scrolling: touch;
    }

    /* Cookie section */
    #cookie-section {
      padding: 20px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 250px;
      background: linear-gradient(135deg, #87CEEB 0%, #ADD8E6 100%);
      margin: 10px;
      border-radius: 20px;
      position: relative;
      flex-shrink: 0;
    }

    .milk-effect {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: radial-gradient(circle at center, rgba(255, 255, 255, 0.1) 0%, rgba(173, 216, 230, 0.05) 70%, transparent 100%);
      border-radius: 20px;
      pointer-events: none;
      z-index: 1;
    }

    .milk-bubble {
      position: absolute;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 50%;
      animation: floatBubble 8s infinite ease-in-out;
    }

    @keyframes floatBubble {
      0%, 100% { transform: translateY(0) scale(1); opacity: 0.7; }
      50% { transform: translateY(-20px) scale(1.1); opacity: 0.9; }
    }

    #cookie {
      font-size: 120px;
      cursor: pointer;
      transition: transform 0.1s;
      z-index: 2;
      text-shadow: 2px 2px 10px rgba(0, 0, 0, 0.3);
    }

    #cookie:active {
      transform: scale(0.9);
    }

    #prestige-btn {
      background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%);
      padding: 10px 15px;
      border-radius: 20px;
      font-weight: bold;
      font-size: 14px;
      border: none;
      color: white;
      margin-top: 10px;
      z-index: 2;
    }

    /* Tabs */
    .tab-buttons {
      display: flex;
      background: #333;
      border-bottom: 1px solid #444;
      flex-shrink: 0;
    }

    .tab-btn {
      flex: 1;
      padding: 12px;
      background: #2b2b2b;
      border: none;
      border-right: 1px solid #444;
      cursor: pointer;
      font-size: 14px;
      color: #fff;
      min-height: 44px;
    }

    .tab-btn.active {
      background: #333;
      border-bottom: 2px solid #ffcc66;
    }

    /* Tab content */
    .tab-content {
      display: none;
      padding: 15px;
      overflow-y: auto;
      -webkit-overflow-scrolling: touch;
    }

    .tab-content.active {
      display: block;
    }

    /* Buildings and Upgrades */
    .building-item, .upgrade-item {
      background: #333;
      margin-bottom: 10px;
      padding: 12px;
      border-radius: 8px;
      border-left: 4px solid #ffcc66;
    }

    .building-header, .upgrade-header {
      display: flex;
      align-items: center;
      margin-bottom: 8px;
    }

    .building-emoji, .upgrade-emoji {
      font-size: 24px;
      margin-right: 12px;
      min-width: 30px;
      text-align: center;
    }

    button {
      background: linear-gradient(135deg, #444 0%, #333 100%);
      color: white;
      border: none;
      padding: 12px;
      margin-top: 8px;
      border-radius: 6px;
      width: 100%;
      cursor: pointer;
      font-weight: bold;
      font-size: 14px;
      min-height: 44px;
    }

    button:active:not(:disabled) {
      transform: scale(0.98);
    }

    button:disabled {
      background: #222;
      color: #777;
      cursor: not-allowed;
    }

    /* Golden Cookie */
    .golden-cookie {
      position: fixed;
      font-size: 40px;
      cursor: pointer;
      z-index: 1000;
      animation: float 3s ease-in-out infinite;
      text-shadow: 0 0 20px rgba(255, 215, 0, 0.8);
    }

    @keyframes float {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-10px); }
    }

    /* Animations */
    @keyframes floatUp {
      from {
        opacity: 1;
        transform: translateY(0) scale(1);
      }
      to {
        opacity: 0;
        transform: translateY(-50px) scale(1.2);
      }
    }

    .frenzy-active {
      animation: frenzyPulse 0.5s infinite;
    }

    @keyframes frenzyPulse {
      0%, 100% { text-shadow: 0 0 20px rgba(255, 204, 102, 0.5); }
      50% { text-shadow: 0 0 30px rgba(255, 50, 50, 0.8); }
    }

    /* Save Notification */
    #save-notification {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background: #4CAF50;
      padding: 10px 15px;
      border-radius: 5px;
      opacity: 0;
      transition: opacity 0.3s;
      z-index: 1000;
    }

    /* Achievements */
    .achievement {
      background: #333;
      margin-bottom: 10px;
      padding: 12px;
      border-radius: 8px;
      border-left: 4px solid #ffcc66;
    }

    .achievement.locked {
      opacity: 0.6;
      border-left: 4px solid #555;
    }

    /* Mini-games */
    .minigame-container {
      background: #333;
      padding: 15px;
      border-radius: 10px;
      margin-bottom: 15px;
    }

    /* Responsive */
    @media (max-height: 700px) {
      #cookie {
        font-size: 100px;
      }
      #cookie-section {
        min-height: 200px;
        padding: 15px;
      }
    }

    @media (max-height: 600px) {
      #cookie {
        font-size: 80px;
      }
      #cookie-section {
        min-height: 180px;
        padding: 10px;
      }
    }
  </style>
</head>
<body>
  <header>üç™ Cookie Clicker Deluxe</header>

  <div id="stats-container">
    <div class="stat">Cookies: <span id="cookies" class="stat-value">0</span></div>
    <div class="stat">CPS: <span id="cps" class="stat-value">0</span></div>
    <div class="stat">Chips: <span id="heavenly-chips" class="stat-value">0</span></div>
  </div>

  <div id="main-content">
    <!-- Cookie Section -->
    <div id="cookie-section">
      <div class="milk-effect"></div>
      <div id="cookie">üç™</div>
      <button id="prestige-btn" onclick="doPrestige()">Prestige (0)</button>
    </div>

    <!-- Tabs -->
    <div class="tab-buttons">
      <button class="tab-btn active" onclick="switchTab('buildings')">Buildings</button>
      <button class="tab-btn" onclick="switchTab('upgrades')">Upgrades</button>
      <button class="tab-btn" onclick="switchTab('achievements')">Achievements</button>
      <button class="tab-btn" onclick="switchTab('minigames')">Mini-games</button>
    </div>

    <!-- Tab Contents -->
    <div id="buildings" class="tab-content active"></div>
    
    <div id="upgrades" class="tab-content"></div>
    
    <div id="achievements" class="tab-content">
      <h3>üèÜ Achievements</h3>
      <div id="achievements-list"></div>
    </div>
    
    <div id="minigames" class="tab-content">
      <h3>üéÆ Mini-games</h3>
      <div class="minigame-container">
        <h4>Cookie Lottery üé∞</h4>
        <p>Spend 100 cookies for a chance to win big!</p>
        <button onclick="playLottery()">Play Lottery (100 cookies)</button>
        <div id="lottery-result"></div>
      </div>
    </div>
  </div>

  <div id="save-notification">Game Saved!</div>

<script>
// =============================
// Game State
// =============================
let cookies = 0;
let totalCookiesEarned = 0;
let cps = 0;
let clickPower = 1;
let totalClicks = 0;
let goldenCookiesClicked = 0;
let playTime = 0;
let heavenlyChips = 0;
let isFrenzyActive = false;
let frenzyTimeLeft = 0;

// =============================
// Buildings with emojis
// =============================
const buildings = [
  { name: "Cursor", emoji: "üëÜ", baseCost: 15, count: 0, cps: 0.1, unlocked: true },
  { name: "Grandma", emoji: "üëµ", baseCost: 100, count: 0, cps: 1, unlocked: true },
  { name: "Farm", emoji: "üöú", baseCost: 1100, count: 0, cps: 8, unlocked: false },
  { name: "Factory", emoji: "üè≠", baseCost: 13000, count: 0, cps: 47, unlocked: false },
  { name: "Mine", emoji: "‚õèÔ∏è", baseCost: 120000, count: 0, cps: 260, unlocked: false },
  { name: "Bank", emoji: "üè¶", baseCost: 1400000, count: 0, cps: 1400, unlocked: false },
  { name: "Temple", emoji: "üõï", baseCost: 20000000, count: 0, cps: 7800, unlocked: false }
];

// =============================
// Upgrades with emojis
// =============================
const upgrades = [
  { 
    name: "Reinforced index finger", 
    emoji: "üí™",
    cost: 50, 
    bought: false, 
    require: "click", 
    effect: () => { clickPower += 1; },
    description: "+1 cookie per click"
  },
  { 
    name: "Carpal tunnel prevention cream", 
    emoji: "üíä",
    cost: 500, 
    bought: false, 
    require: "click", 
    effect: () => { clickPower += 1; },
    description: "+1 cookie per click"
  },
  { 
    name: "Forwards from grandma", 
    emoji: "üìß",
    cost: 1000, 
    bought: false, 
    require: 1, 
    effect: () => { buildings[1].cps *= 2; },
    description: "Double Grandma CPS"
  }
];

// =============================
// Achievements
// =============================
const achievements = [
  {
    id: "first_click",
    name: "First Click!",
    description: "Click the cookie for the first time",
    unlocked: false,
    check: () => totalClicks >= 1
  },
  {
    id: "hundred_clicks",
    name: "Cookie Monster",
    description: "Reach 100 clicks",
    unlocked: false,
    check: () => totalClicks >= 100
  },
  {
    id: "thousand_cookies",
    name: "Cookie Collector",
    description: "Earn 1,000 cookies total",
    unlocked: false,
    check: () => totalCookiesEarned >= 1000
  },
  {
    id: "first_golden",
    name: "Golden Touch",
    description: "Click your first golden cookie",
    unlocked: false,
    check: () => goldenCookiesClicked >= 1
  }
];

// =============================
// DOM Elements
// =============================
const cookieEl = document.getElementById("cookie");
const cookiesEl = document.getElementById("cookies");
const cpsEl = document.getElementById("cps");
const heavenlyChipsEl = document.getElementById("heavenly-chips");
const buildingsEl = document.getElementById("buildings");
const upgradesEl = document.getElementById("upgrades");
const achievementsEl = document.getElementById("achievements-list");
const prestigeBtn = document.getElementById("prestige-btn");

// =============================
// Utility Functions
// =============================
function formatNumber(num) {
  if (num >= 1e12) return (num / 1e12).toFixed(2) + 'T';
  if (num >= 1e9) return (num / 1e9).toFixed(2) + 'B';
  if (num >= 1e6) return (num / 1e6).toFixed(2) + 'M';
  if (num >= 1e3) return (num / 1e3).toFixed(2) + 'K';
  return Math.floor(num).toString();
}

function switchTab(tabName) {
  document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
  document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
  
  document.getElementById(tabName).classList.add('active');
  document.querySelector(`.tab-btn[onclick="switchTab('${tabName}')"]`).classList.add('active');
}

function createMilkBubbles() {
  const milkEffect = document.querySelector('.milk-effect');
  for (let i = 0; i < 10; i++) {
    const bubble = document.createElement('div');
    bubble.className = 'milk-bubble';
    
    const size = Math.random() * 15 + 5;
    const left = Math.random() * 100;
    const top = Math.random() * 100;
    const delay = Math.random() * 5;
    
    bubble.style.width = size + 'px';
    bubble.style.height = size + 'px';
    bubble.style.left = left + '%';
    bubble.style.top = top + '%';
    bubble.style.animationDelay = delay + 's';
    
    milkEffect.appendChild(bubble);
  }
}

// =============================
// UI Update
// =============================
function updateUI() {
  cookiesEl.textContent = formatNumber(cookies);
  cpsEl.textContent = formatNumber(cps);
  heavenlyChipsEl.textContent = formatNumber(heavenlyChips);
  
  // Update prestige button
  const chips = calculateHeavenlyChips();
  prestigeBtn.textContent = `Prestige (${formatNumber(chips)})`;
  prestigeBtn.disabled = chips <= 0;

  // Update buildings
  buildingsEl.innerHTML = '<h3>üèóÔ∏è Buildings</h3>';
  buildings.forEach((b, i) => {
    if (!b.unlocked && cookies >= b.baseCost * 0.5) b.unlocked = true;
    
    if (b.unlocked) {
      const cost = Math.floor(b.baseCost * Math.pow(1.15, b.count));
      const buildingDiv = document.createElement('div');
      buildingDiv.className = 'building-item';
      buildingDiv.innerHTML = `
        <div class="building-header">
          <span class="building-emoji">${b.emoji}</span>
          <div>
            <div><strong>${b.name}</strong> (${b.count})</div>
            <div>${formatNumber(b.count * b.cps * (1 + heavenlyChips * 0.01))} CPS</div>
          </div>
        </div>
        <div>Cost: ${formatNumber(cost)} cookies</div>
      `;
      
      const btn = document.createElement('button');
      btn.textContent = `Buy ${b.name}`;
      btn.disabled = cookies < cost;
      btn.onclick = () => buyBuilding(i);
      buildingDiv.appendChild(btn);
      
      buildingsEl.appendChild(buildingDiv);
    }
  });

  // Update upgrades
  upgradesEl.innerHTML = '<h3>‚ö° Upgrades</h3>';
  upgrades.forEach((u, i) => {
    if (!u.bought) {
      let available = false;
      if (u.require === "click") available = true;
      else if (typeof u.require === "number" && buildings[u.require].count > 0) available = true;

      if (available) {
        const upgradeDiv = document.createElement('div');
        upgradeDiv.className = 'upgrade-item';
        upgradeDiv.innerHTML = `
          <div class="upgrade-header">
            <span class="upgrade-emoji">${u.emoji}</span>
            <div>
              <div><strong>${u.name}</strong></div>
              <div>${u.description}</div>
            </div>
          </div>
          <div>Cost: ${formatNumber(u.cost)} cookies</div>
        `;
        
        const btn = document.createElement('button');
        btn.textContent = 'Buy Upgrade';
        btn.disabled = cookies < u.cost;
        btn.onclick = () => buyUpgrade(i);
        upgradeDiv.appendChild(btn);
        
        upgradesEl.appendChild(upgradeDiv);
      }
    }
  });

  // Update achievements
  updateAchievements();
}

function updateAchievements() {
  achievementsEl.innerHTML = '';
  achievements.forEach(achievement => {
    const achieved = achievement.check();
    if (achieved && !achievement.unlocked) {
      achievement.unlocked = true;
      showNotification(`Achievement unlocked: ${achievement.name}!`);
    }
    
    const achievementDiv = document.createElement('div');
    achievementDiv.className = `achievement ${achievement.unlocked ? '' : 'locked'}`;
    achievementDiv.innerHTML = `
      <div><strong>${achievement.name}</strong></div>
      <div>${achievement.description}</div>
      <div>${achievement.unlocked ? '‚úÖ Unlocked' : 'üîí Locked'}</div>
    `;
    achievementsEl.appendChild(achievementDiv);
  });
}

// =============================
// Game Mechanics
// =============================
function calculateCPS() {
  cps = 0;
  buildings.forEach(b => {
    cps += b.count * b.cps * (1 + heavenlyChips * 0.01);
  });
  if (isFrenzyActive) cps *= 7;
}

function buyBuilding(index) {
  const b = buildings[index];
  const cost = Math.floor(b.baseCost * Math.pow(1.15, b.count));
  if (cookies >= cost) {
    cookies -= cost;
    b.count++;
    calculateCPS();
    updateUI();
  }
}

function buyUpgrade(index) {
  const u = upgrades[index];
  if (cookies >= u.cost && !u.bought) {
    cookies -= u.cost;
    u.bought = true;
    u.effect();
    calculateCPS();
    updateUI();
  }
}

// =============================
// Mini-games
// =============================
function playLottery() {
  if (cookies >= 100) {
    cookies -= 100;
    const win = Math.random() < 0.3; // 30% chance to win
    const prize = win ? Math.floor(Math.random() * 1000) + 500 : 0;
    
    if (win) {
      cookies += prize;
      showNotification(`üéâ You won ${prize} cookies!`);
    } else {
      showNotification("üò¢ Better luck next time!");
    }
    updateUI();
  }
}

// =============================
// Prestige System
// =============================
function calculateHeavenlyChips() {
  return Math.max(0, Math.floor(Math.sqrt(totalCookiesEarned / 1000000) * 10) - heavenlyChips);
}

function doPrestige() {
  const chipsGained = calculateHeavenlyChips();
  if (chipsGained > 0 && confirm(`Reset for ${formatNumber(chipsGained)} Heavenly Chips?`)) {
    heavenlyChips += chipsGained;
    resetGameState();
  }
}

function resetGameState() {
  cookies = clickPower = totalClicks = goldenCookiesClicked = playTime = 0;
  isFrenzyActive = false;
  frenzyTimeLeft = 0;
  
  buildings.forEach(b => {
    b.count = 0;
    b.unlocked = b.name === "Cursor" || b.name === "Grandma";
  });
  
  upgrades.forEach(u => u.bought = false);
  achievements.forEach(a => a.unlocked = false);
  
  calculateCPS();
  saveGame();
  updateUI();
}

// =============================
// Notifications
// =============================
function showNotification(message) {
  const notification = document.createElement('div');
  notification.style.cssText = `
    position: fixed;
    top: 20px;
    left: 50%;
    transform: translateX(-50%);
    background: #4CAF50;
    color: white;
    padding: 12px 20px;
    border-radius: 8px;
    z-index: 1000;
    font-weight: bold;
  `;
  notification.textContent = message;
  document.body.appendChild(notification);
  
  setTimeout(() => notification.remove(), 3000);
}

// =============================
// Save/Load System
// =============================
function saveGame() {
  const saveData = {
    cookies, totalCookiesEarned, clickPower, totalClicks,
    goldenCookiesClicked, playTime, heavenlyChips, isFrenzyActive, frenzyTimeLeft,
    buildings: buildings.map(b => ({ count: b.count, unlocked: b.unlocked })),
    upgrades: upgrades.map(u => ({ bought: u.bought })),
    achievements: achievements.map(a => ({ unlocked: a.unlocked }))
  };
  
  localStorage.setItem('cookieClickerSave', JSON.stringify(saveData));
}

function loadGame() {
  const data = localStorage.getItem('cookieClickerSave');
  if (data) {
    try {
      const save = JSON.parse(data);
      Object.assign(this, save);
      
      if (save.buildings) {
        save.buildings.forEach((b, i) => {
          if (i < buildings.length) {
            buildings[i].count = b.count || 0;
            buildings[i].unlocked = b.unlocked || false;
          }
        });
      }
      
      if (save.upgrades) save.upgrades.forEach((u, i) => {
        if (i < upgrades.length) upgrades[i].bought = u.bought || false;
      });
      
      if (save.achievements) save.achievements.forEach((a, i) => {
        if (i < achievements.length) achievements[i].unlocked = a.unlocked || false;
      });
      
      calculateCPS();
    } catch (e) {
      console.error('Error loading save:', e);
    }
  }
}

// =============================
// Event Listeners
// =============================
function handleCookieClick(e) {
  const x = e.type.includes('touch') ? e.touches[0].clientX : e.clientX;
  const y = e.type.includes('touch') ? e.touches[0].clientY : e.clientY;
  
  cookies += clickPower;
  totalCookiesEarned += clickPower;
  totalClicks++;
  spawnFloatingText(x, y, `+${formatNumber(clickPower)}`);
  updateUI();
  
  if (e.type.includes('touch')) e.preventDefault();
}

cookieEl.addEventListener('click', handleCookieClick);
cookieEl.addEventListener('touchstart', handleCookieClick, { passive: false });

// =============================
// Game Loop
// =============================
setInterval(() => {
  cookies += cps / 10;
  totalCookiesEarned += cps / 10;
  playTime += 0.1;
  
  if (isFrenzyActive) {
    frenzyTimeLeft -= 0.1;
    if (frenzyTimeLeft <= 0) {
      isFrenzyActive = false;
      cookieEl.classList.remove('frenzy-active');
      calculateCPS();
    }
  }
  
  updateUI();
}, 100);

setInterval(saveGame, 30000);

// =============================
// Initialization
// =============================
loadGame();
createMilkBubbles();
updateUI();
</script>
</body>
</html>
